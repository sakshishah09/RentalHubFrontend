{"ast":null,"code":"import { HttpEventType } from '@angular/common/http';\nimport { FormsModule, ReactiveFormsModule, Validators } from '@angular/forms';\nimport { finalize } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../../../core/services/product.service\";\nfunction AddProductComponent_option_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 19);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const c_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", c_r2.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(c_r2.name);\n  }\n}\nfunction AddProductComponent_option_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 19);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const sc_r3 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", sc_r3.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(sc_r3.name);\n  }\n}\nfunction AddProductComponent_div_34_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 7)(1, \"div\", 5)(2, \"label\");\n    i0.ɵɵtext(3, \"Price Per Day\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"input\", 20);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function AddProductComponent_div_34_Template_input_ngModelChange_4_listener($event) {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r4 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r4.product.pricePerDay, $event) || (ctx_r4.product.pricePerDay = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r4.product.pricePerDay);\n  }\n}\nfunction AddProductComponent_div_35_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 7)(1, \"div\", 5)(2, \"label\");\n    i0.ɵɵtext(3, \"Price For Sale\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"input\", 21);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function AddProductComponent_div_35_Template_input_ngModelChange_4_listener($event) {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r4 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r4.product.priceForSale, $event) || (ctx_r4.product.priceForSale = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r4.product.priceForSale);\n  }\n}\nfunction AddProductComponent_div_40_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 22);\n    i0.ɵɵelement(1, \"img\", 23);\n    i0.ɵɵelementStart(2, \"button\", 24);\n    i0.ɵɵlistener(\"click\", function AddProductComponent_div_40_Template_button_click_2_listener() {\n      const i_r8 = i0.ɵɵrestoreView(_r7).index;\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.removeImage(i_r8));\n    });\n    i0.ɵɵtext(3, \"\\u00D7\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const img_r9 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"src\", img_r9, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction AddProductComponent_label_41_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"label\", 25);\n    i0.ɵɵelement(1, \"i\", 26);\n    i0.ɵɵelementStart(2, \"input\", 27);\n    i0.ɵɵlistener(\"change\", function AddProductComponent_label_41_Template_input_change_2_listener($event) {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.onImageSelect($event));\n    });\n    i0.ɵɵelementEnd()();\n  }\n}\nexport let AddProductComponent = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class AddProductComponent {\n    constructor(fb, productService) {\n      this.fb = fb;\n      this.productService = productService;\n      this.categories = [];\n      this.subcategories = [];\n      this.images = [];\n      this.previewUrls = [];\n      this.maxImages = 4;\n      this.uploading = false;\n      this.uploadProgress = 0;\n      this.errorMsg = '';\n      this.productForm = this.fb.group({\n        name: ['', [Validators.required, Validators.maxLength(120)]],\n        description: ['', [Validators.maxLength(2000)]],\n        size: [''],\n        color: [''],\n        pricePerDay: [null, [Validators.min(0)]],\n        priceForSale: [null, [Validators.min(0)]],\n        available: [true, Validators.required],\n        categoryId: [null, Validators.required],\n        subcategoryId: [null, Validators.required]\n      });\n    }\n    ngOnInit() {\n      this.loadCategories();\n      // when category changes, fetch subcategories\n      this.productForm.get('categoryId')?.valueChanges.subscribe(catId => {\n        this.subcategories = [];\n        this.productForm.get('subcategoryId')?.setValue(null);\n        if (catId) {\n          this.loadSubcategories(catId);\n        }\n      });\n    }\n    loadCategories() {\n      this.productService.getCategories().subscribe({\n        next: cats => this.categories = cats,\n        error: () => this.categories = []\n      });\n    }\n    loadSubcategories(categoryId) {\n      this.productService.getSubcategories(categoryId).subscribe({\n        next: subs => this.subcategories = subs,\n        error: () => this.subcategories = []\n      });\n    }\n    onImageSelect(event) {\n      this.errorMsg = '';\n      const input = event.target;\n      if (!input.files) return;\n      const selected = Array.from(input.files);\n      if (this.images.length + selected.length > this.maxImages) {\n        this.errorMsg = `Maximum ${this.maxImages} images allowed.`;\n        return;\n      }\n      selected.forEach(file => {\n        // basic image type check\n        if (!file.type.startsWith('image/')) return;\n        this.images.push(file);\n        const reader = new FileReader();\n        reader.onload = e => this.previewUrls.push(e.target.result);\n        reader.readAsDataURL(file);\n      });\n      // reset input to allow same-file reselect if user removed\n      input.value = '';\n    }\n    removeImage(index) {\n      this.images.splice(index, 1);\n      this.previewUrls.splice(index, 1);\n    }\n    // Build the FormData payload: product JSON + images[]\n    buildFormData() {\n      const formData = new FormData();\n      // product json as 'product' part (server expects this name — adjust if needed)\n      const productPayload = {\n        name: this.productForm.value.name,\n        description: this.productForm.value.description,\n        size: this.productForm.value.size,\n        color: this.productForm.value.color,\n        pricePerDay: this.productForm.value.pricePerDay,\n        priceForSale: this.productForm.value.priceForSale,\n        available: this.productForm.value.available,\n        categoryId: this.productForm.value.categoryId,\n        subcategoryId: this.productForm.value.subcategoryId\n        // add userId server side or include if required\n      };\n      formData.append('product', new Blob([JSON.stringify(productPayload)], {\n        type: 'application/json'\n      }));\n      this.images.forEach((file, idx) => {\n        // server should accept images as 'images' or 'images[]' — adjust name if needed\n        formData.append('images', file, file.name);\n      });\n      return formData;\n    }\n    submit() {\n      this.errorMsg = '';\n      if (this.productForm.invalid) {\n        this.productForm.markAllAsTouched();\n        return;\n      }\n      if (this.images.length === 0) {\n        this.errorMsg = 'Please upload at least one image.';\n        return;\n      }\n      const formData = this.buildFormData();\n      this.uploading = true;\n      this.uploadProgress = 0;\n      this.productService.createProduct(formData).pipe(finalize(() => this.uploading = false)).subscribe({\n        next: event => {\n          if (event.type === HttpEventType.UploadProgress && event.total) {\n            this.uploadProgress = Math.round(100 * (event.loaded / event.total));\n          } else if (event.type === HttpEventType.Response) {\n            // Success\n            console.log('Upload response', event.body);\n            // reset form & previews\n            this.productForm.reset({\n              available: true\n            });\n            this.images = [];\n            this.previewUrls = [];\n            this.uploadProgress = 0;\n            // show success UI (toast / redirect)\n            alert('Product created successfully');\n          }\n        },\n        error: err => {\n          console.error(err);\n          this.errorMsg = 'Upload failed. Try again.';\n        }\n      });\n    }\n    // convenience getters for template\n    get f() {\n      return this.productForm.controls;\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function AddProductComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || AddProductComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.ProductService));\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AddProductComponent,\n      selectors: [[\"app-add-product\"]],\n      decls: 44,\n      vars: 12,\n      consts: [[\"productForm\", \"ngForm\"], [1, \"main-content\"], [1, \"add-product-container\"], [1, \"page-title\"], [3, \"ngSubmit\"], [1, \"form-group\"], [\"type\", \"text\", \"name\", \"name\", \"required\", \"\", 3, \"ngModelChange\", \"ngModel\"], [1, \"form-row\"], [\"name\", \"category\", 3, \"ngModelChange\", \"change\", \"ngModel\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"name\", \"subcategory\", 3, \"ngModelChange\", \"ngModel\"], [\"type\", \"text\", \"name\", \"size\", 3, \"ngModelChange\", \"ngModel\"], [\"type\", \"text\", \"name\", \"color\", 3, \"ngModelChange\", \"ngModel\"], [\"name\", \"description\", \"rows\", \"3\", 3, \"ngModelChange\", \"ngModel\"], [\"class\", \"form-row\", 4, \"ngIf\"], [1, \"image-grid\"], [\"class\", \"image-box\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"upload-box\", 4, \"ngIf\"], [\"type\", \"submit\", 1, \"submit-btn\"], [3, \"value\"], [\"type\", \"number\", \"name\", \"pricePerDay\", 3, \"ngModelChange\", \"ngModel\"], [\"type\", \"number\", \"name\", \"priceForSale\", 3, \"ngModelChange\", \"ngModel\"], [1, \"image-box\"], [\"alt\", \"preview\", 3, \"src\"], [\"type\", \"button\", 1, \"remove-btn\", 3, \"click\"], [1, \"upload-box\"], [1, \"fas\", \"fa-cloud-upload-alt\"], [\"type\", \"file\", \"multiple\", \"\", 3, \"change\"]],\n      template: function AddProductComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          const _r1 = i0.ɵɵgetCurrentView();\n          i0.ɵɵelementStart(0, \"div\", 1)(1, \"div\", 2)(2, \"h2\", 3);\n          i0.ɵɵtext(3, \"Add New Product\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(4, \"form\", 4, 0);\n          i0.ɵɵlistener(\"ngSubmit\", function AddProductComponent_Template_form_ngSubmit_4_listener() {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.onSubmit());\n          });\n          i0.ɵɵelementStart(6, \"div\", 5)(7, \"label\");\n          i0.ɵɵtext(8, \"Product Name\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(9, \"input\", 6);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function AddProductComponent_Template_input_ngModelChange_9_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            i0.ɵɵtwoWayBindingSet(ctx.product.name, $event) || (ctx.product.name = $event);\n            return i0.ɵɵresetView($event);\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(10, \"div\", 7)(11, \"div\", 5)(12, \"label\");\n          i0.ɵɵtext(13, \"Category\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(14, \"select\", 8);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function AddProductComponent_Template_select_ngModelChange_14_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            i0.ɵɵtwoWayBindingSet(ctx.product.categoryId, $event) || (ctx.product.categoryId = $event);\n            return i0.ɵɵresetView($event);\n          });\n          i0.ɵɵlistener(\"change\", function AddProductComponent_Template_select_change_14_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            return i0.ɵɵresetView(ctx.onCategoryChange($event));\n          });\n          i0.ɵɵtemplate(15, AddProductComponent_option_15_Template, 2, 2, \"option\", 9);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(16, \"div\", 5)(17, \"label\");\n          i0.ɵɵtext(18, \"Subcategory\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(19, \"select\", 10);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function AddProductComponent_Template_select_ngModelChange_19_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            i0.ɵɵtwoWayBindingSet(ctx.product.subcategoryId, $event) || (ctx.product.subcategoryId = $event);\n            return i0.ɵɵresetView($event);\n          });\n          i0.ɵɵtemplate(20, AddProductComponent_option_20_Template, 2, 2, \"option\", 9);\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(21, \"div\", 7)(22, \"div\", 5)(23, \"label\");\n          i0.ɵɵtext(24, \"Size\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(25, \"input\", 11);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function AddProductComponent_Template_input_ngModelChange_25_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            i0.ɵɵtwoWayBindingSet(ctx.product.size, $event) || (ctx.product.size = $event);\n            return i0.ɵɵresetView($event);\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(26, \"div\", 5)(27, \"label\");\n          i0.ɵɵtext(28, \"Color\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(29, \"input\", 12);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function AddProductComponent_Template_input_ngModelChange_29_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            i0.ɵɵtwoWayBindingSet(ctx.product.color, $event) || (ctx.product.color = $event);\n            return i0.ɵɵresetView($event);\n          });\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(30, \"div\", 5)(31, \"label\");\n          i0.ɵɵtext(32, \"Description\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(33, \"textarea\", 13);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function AddProductComponent_Template_textarea_ngModelChange_33_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            i0.ɵɵtwoWayBindingSet(ctx.product.description, $event) || (ctx.product.description = $event);\n            return i0.ɵɵresetView($event);\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(34, AddProductComponent_div_34_Template, 5, 1, \"div\", 14)(35, AddProductComponent_div_35_Template, 5, 1, \"div\", 14);\n          i0.ɵɵelementStart(36, \"div\", 5)(37, \"label\");\n          i0.ɵɵtext(38, \"Upload Images (Max 4)\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(39, \"div\", 15);\n          i0.ɵɵtemplate(40, AddProductComponent_div_40_Template, 4, 1, \"div\", 16)(41, AddProductComponent_label_41_Template, 3, 0, \"label\", 17);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(42, \"button\", 18);\n          i0.ɵɵtext(43, \"Submit\");\n          i0.ɵɵelementEnd()()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(9);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.product.name);\n          i0.ɵɵadvance(5);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.product.categoryId);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngForOf\", ctx.categories);\n          i0.ɵɵadvance(4);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.product.subcategoryId);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngForOf\", ctx.subcategories);\n          i0.ɵɵadvance(5);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.product.size);\n          i0.ɵɵadvance(4);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.product.color);\n          i0.ɵɵadvance(4);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.product.description);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.product.availability === \"rent\" || ctx.product.availability === \"both\");\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.product.availability === \"sell\" || ctx.product.availability === \"both\");\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"ngForOf\", ctx.previewUrls);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.previewUrls.length < 4);\n        }\n      },\n      dependencies: [FormsModule, i1.ɵNgNoValidate, i1.NgSelectOption, i1.ɵNgSelectMultipleOption, i1.DefaultValueAccessor, i1.NumberValueAccessor, i1.SelectControlValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.RequiredValidator, i1.NgModel, i1.NgForm, ReactiveFormsModule],\n      styles: [\".bg-lightest[_ngcontent-%COMP%]{background-color:#f8f9fa}.upload-placeholder[_ngcontent-%COMP%]{cursor:pointer;height:180px;border:2px dashed #ccc;display:flex;align-items:center;justify-content:center;transition:border-color .3s ease,background-color .2s ease}.upload-placeholder[_ngcontent-%COMP%]:hover{border-color:#2563eb;background-color:#2563eb0d}.upload-input[_ngcontent-%COMP%]{position:absolute;opacity:0;width:100%;height:100%;top:0;left:0;cursor:pointer}.image-box[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:180px;object-fit:cover}.options[_ngcontent-%COMP%]{display:flex;gap:1rem}.options[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{background:#f3f4f6;padding:6px 12px;border-radius:6px;cursor:pointer;transition:background .3s}.options[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:hover{background:#e5e7eb}\"]\n    }));\n  }\n  _staticBlock();\n  return AddProductComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import { HttpEventType } from '@angular/common/http';\nimport { FormsModule, ReactiveFormsModule, Validators } from '@angular/forms';\nimport { finalize } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../../../core/services/product.service\";\nfunction AddProductComponent_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 26);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.errorMsg, \" \");\n  }\n}\nfunction AddProductComponent_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 27);\n    i0.ɵɵtext(1, \" Product name is required (max 120 chars) \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddProductComponent_option_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 28);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const cat_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", cat_r2.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(cat_r2.name);\n  }\n}\nfunction AddProductComponent_option_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 28);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const sub_r3 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", sub_r3.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(sub_r3.name);\n  }\n}\nfunction AddProductComponent_div_64_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 29);\n    i0.ɵɵelement(1, \"img\", 30);\n    i0.ɵɵelementStart(2, \"button\", 31);\n    i0.ɵɵlistener(\"click\", function AddProductComponent_div_64_Template_button_click_2_listener() {\n      const i_r5 = i0.ɵɵrestoreView(_r4).index;\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.removeImage(i_r5));\n    });\n    i0.ɵɵtext(3, \"\\u2715\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const url_r6 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"src\", url_r6, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction AddProductComponent_div_68_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 32)(1, \"div\", 33);\n    i0.ɵɵelement(2, \"div\", 34);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵstyleProp(\"width\", ctx_r0.uploadProgress, \"%\");\n  }\n}\nexport let AddProductComponent = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class AddProductComponent {\n    constructor(fb, productService) {\n      this.fb = fb;\n      this.productService = productService;\n      this.categories = [];\n      this.subcategories = [];\n      this.images = [];\n      this.previewUrls = [];\n      this.maxImages = 4;\n      this.uploading = false;\n      this.uploadProgress = 0;\n      this.errorMsg = '';\n      this.productForm = this.fb.group({\n        name: ['', [Validators.required, Validators.maxLength(120)]],\n        description: ['', [Validators.maxLength(2000)]],\n        size: [''],\n        color: [''],\n        pricePerDay: [null, [Validators.min(0)]],\n        priceForSale: [null, [Validators.min(0)]],\n        available: [true, Validators.required],\n        categoryId: [null, Validators.required],\n        subcategoryId: [null, Validators.required]\n      });\n    }\n    ngOnInit() {\n      this.loadCategories();\n      // when category changes, fetch subcategories\n      this.productForm.get('categoryId')?.valueChanges.subscribe(catId => {\n        this.subcategories = [];\n        this.productForm.get('subcategoryId')?.setValue(null);\n        if (catId) {\n          this.loadSubcategories(catId);\n        }\n      });\n    }\n    loadCategories() {\n      this.productService.getCategories().subscribe({\n        next: cats => this.categories = cats,\n        error: () => this.categories = []\n      });\n    }\n    loadSubcategories(categoryId) {\n      this.productService.getSubcategories(categoryId).subscribe({\n        next: subs => this.subcategories = subs,\n        error: () => this.subcategories = []\n      });\n    }\n    onImageSelect(event) {\n      this.errorMsg = '';\n      const input = event.target;\n      if (!input.files) return;\n      const selected = Array.from(input.files);\n      if (this.images.length + selected.length > this.maxImages) {\n        this.errorMsg = `Maximum ${this.maxImages} images allowed.`;\n        return;\n      }\n      selected.forEach(file => {\n        // basic image type check\n        if (!file.type.startsWith('image/')) return;\n        this.images.push(file);\n        const reader = new FileReader();\n        reader.onload = e => this.previewUrls.push(e.target.result);\n        reader.readAsDataURL(file);\n      });\n      // reset input to allow same-file reselect if user removed\n      input.value = '';\n    }\n    removeImage(index) {\n      this.images.splice(index, 1);\n      this.previewUrls.splice(index, 1);\n    }\n    // Build the FormData payload: product JSON + images[]\n    buildFormData() {\n      const formData = new FormData();\n      // product json as 'product' part (server expects this name — adjust if needed)\n      const productPayload = {\n        name: this.productForm.value.name,\n        description: this.productForm.value.description,\n        size: this.productForm.value.size,\n        color: this.productForm.value.color,\n        pricePerDay: this.productForm.value.pricePerDay,\n        priceForSale: this.productForm.value.priceForSale,\n        available: this.productForm.value.available,\n        categoryId: this.productForm.value.categoryId,\n        subcategoryId: this.productForm.value.subcategoryId\n        // add userId server side or include if required\n      };\n      formData.append('product', new Blob([JSON.stringify(productPayload)], {\n        type: 'application/json'\n      }));\n      this.images.forEach((file, idx) => {\n        // server should accept images as 'images' or 'images[]' — adjust name if needed\n        formData.append('images', file, file.name);\n      });\n      return formData;\n    }\n    submit() {\n      this.errorMsg = '';\n      if (this.productForm.invalid) {\n        this.productForm.markAllAsTouched();\n        return;\n      }\n      if (this.images.length === 0) {\n        this.errorMsg = 'Please upload at least one image.';\n        return;\n      }\n      const formData = this.buildFormData();\n      this.uploading = true;\n      this.uploadProgress = 0;\n      this.productService.createProduct(formData).pipe(finalize(() => this.uploading = false)).subscribe({\n        next: event => {\n          if (event.type === HttpEventType.UploadProgress && event.total) {\n            this.uploadProgress = Math.round(100 * (event.loaded / event.total));\n          } else if (event.type === HttpEventType.Response) {\n            // Success\n            console.log('Upload response', event.body);\n            // reset form & previews\n            this.productForm.reset({\n              available: true\n            });\n            this.images = [];\n            this.previewUrls = [];\n            this.uploadProgress = 0;\n            // show success UI (toast / redirect)\n            alert('Product created successfully');\n          }\n        },\n        error: err => {\n          console.error(err);\n          this.errorMsg = 'Upload failed. Try again.';\n        }\n      });\n    }\n    // convenience getters for template\n    get f() {\n      return this.productForm.controls;\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function AddProductComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || AddProductComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.ProductService));\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AddProductComponent,\n      selectors: [[\"app-add-product\"]],\n      decls: 69,\n      vars: 13,\n      consts: [[1, \"p-8\", \"bg-gray-50\", \"min-h-screen\"], [1, \"max-w-3xl\", \"mx-auto\", \"bg-white\", \"p-8\", \"rounded-2xl\", \"shadow-lg\"], [1, \"text-3xl\", \"font-bold\", \"mb-6\", \"text-blue-600\", \"text-center\"], [\"class\", \"text-red-600 mb-4 text-center\", 4, \"ngIf\"], [1, \"space-y-6\", 3, \"ngSubmit\", \"formGroup\"], [1, \"block\", \"text-gray-700\", \"font-medium\", \"mb-1\"], [\"formControlName\", \"name\", \"type\", \"text\", \"placeholder\", \"Enter product name\", 1, \"w-full\", \"border\", \"rounded-lg\", \"p-2\", \"focus:ring-2\", \"focus:ring-blue-400\"], [\"class\", \"text-red-500 text-sm\", 4, \"ngIf\"], [\"formControlName\", \"categoryId\", 1, \"w-full\", \"border\", \"rounded-lg\", \"p-2\"], [\"value\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"formControlName\", \"subcategoryId\", 1, \"w-full\", \"border\", \"rounded-lg\", \"p-2\"], [1, \"flex\", \"gap-4\"], [\"type\", \"radio\", \"formControlName\", \"available\", 3, \"value\"], [\"formControlName\", \"size\", \"type\", \"text\", \"placeholder\", \"e.g., Medium, 42, etc.\", 1, \"w-full\", \"border\", \"rounded-lg\", \"p-2\"], [\"formControlName\", \"color\", \"type\", \"text\", \"placeholder\", \"e.g., Red, Black\", 1, \"w-full\", \"border\", \"rounded-lg\", \"p-2\"], [\"formControlName\", \"description\", \"rows\", \"3\", \"placeholder\", \"Enter product details\", 1, \"w-full\", \"border\", \"rounded-lg\", \"p-2\"], [1, \"grid\", \"grid-cols-2\", \"gap-4\"], [\"formControlName\", \"pricePerDay\", \"type\", \"number\", \"placeholder\", \"e.g., 500\", 1, \"w-full\", \"border\", \"rounded-lg\", \"p-2\"], [\"formControlName\", \"priceForSale\", \"type\", \"number\", \"placeholder\", \"e.g., 15000\", 1, \"w-full\", \"border\", \"rounded-lg\", \"p-2\"], [\"type\", \"file\", \"multiple\", \"\", \"accept\", \"image/*\", 1, \"w-full\", \"border\", \"rounded-lg\", \"p-2\", 3, \"change\"], [1, \"flex\", \"flex-wrap\", \"gap-3\", \"mt-3\"], [\"class\", \"relative\", 4, \"ngFor\", \"ngForOf\"], [1, \"text-center\", \"mt-6\"], [\"type\", \"submit\", 1, \"bg-blue-600\", \"hover:bg-blue-700\", \"text-white\", \"font-semibold\", \"px-6\", \"py-2\", \"rounded-lg\", \"shadow-md\", 3, \"disabled\"], [\"class\", \"mt-4\", 4, \"ngIf\"], [1, \"text-red-600\", \"mb-4\", \"text-center\"], [1, \"text-red-500\", \"text-sm\"], [3, \"value\"], [1, \"relative\"], [\"alt\", \"Preview\", 1, \"w-24\", \"h-24\", \"rounded-lg\", \"object-cover\", \"border\", 3, \"src\"], [\"type\", \"button\", 1, \"absolute\", \"-top-2\", \"-right-2\", \"bg-red-600\", \"text-white\", \"text-xs\", \"rounded-full\", \"w-6\", \"h-6\", 3, \"click\"], [1, \"mt-4\"], [1, \"w-full\", \"bg-gray-200\", \"rounded-full\", \"h-2\"], [1, \"bg-blue-600\", \"h-2\", \"rounded-full\"]],\n      template: function AddProductComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h2\", 2);\n          i0.ɵɵtext(3, \"Add New Product\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(4, AddProductComponent_div_4_Template, 2, 1, \"div\", 3);\n          i0.ɵɵelementStart(5, \"form\", 4);\n          i0.ɵɵlistener(\"ngSubmit\", function AddProductComponent_Template_form_ngSubmit_5_listener() {\n            return ctx.submit();\n          });\n          i0.ɵɵelementStart(6, \"div\")(7, \"label\", 5);\n          i0.ɵɵtext(8, \"Product Name\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(9, \"input\", 6);\n          i0.ɵɵtemplate(10, AddProductComponent_div_10_Template, 2, 0, \"div\", 7);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(11, \"div\")(12, \"label\", 5);\n          i0.ɵɵtext(13, \"Category\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(14, \"select\", 8)(15, \"option\", 9);\n          i0.ɵɵtext(16, \"Select category\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(17, AddProductComponent_option_17_Template, 2, 2, \"option\", 10);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(18, \"div\")(19, \"label\", 5);\n          i0.ɵɵtext(20, \"Subcategory\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(21, \"select\", 11)(22, \"option\", 9);\n          i0.ɵɵtext(23, \"Select subcategory\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(24, AddProductComponent_option_24_Template, 2, 2, \"option\", 10);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(25, \"div\")(26, \"label\", 5);\n          i0.ɵɵtext(27, \"Product Type\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(28, \"div\", 12)(29, \"label\");\n          i0.ɵɵelement(30, \"input\", 13);\n          i0.ɵɵtext(31, \" Sell\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(32, \"label\");\n          i0.ɵɵelement(33, \"input\", 13);\n          i0.ɵɵtext(34, \" Rent\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(35, \"label\");\n          i0.ɵɵelement(36, \"input\", 13);\n          i0.ɵɵtext(37, \" Both\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(38, \"div\")(39, \"label\", 5);\n          i0.ɵɵtext(40, \"Product Size\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(41, \"input\", 14);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(42, \"div\")(43, \"label\", 5);\n          i0.ɵɵtext(44, \"Product Color\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(45, \"input\", 15);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(46, \"div\")(47, \"label\", 5);\n          i0.ɵɵtext(48, \"Description\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(49, \"textarea\", 16);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(50, \"div\", 17)(51, \"div\")(52, \"label\", 5);\n          i0.ɵɵtext(53, \"Price Per Day (Rent)\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(54, \"input\", 18);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(55, \"div\")(56, \"label\", 5);\n          i0.ɵɵtext(57, \"Price For Sale\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(58, \"input\", 19);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(59, \"div\")(60, \"label\", 5);\n          i0.ɵɵtext(61);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(62, \"input\", 20);\n          i0.ɵɵlistener(\"change\", function AddProductComponent_Template_input_change_62_listener($event) {\n            return ctx.onImageSelect($event);\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(63, \"div\", 21);\n          i0.ɵɵtemplate(64, AddProductComponent_div_64_Template, 4, 1, \"div\", 22);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(65, \"div\", 23)(66, \"button\", 24);\n          i0.ɵɵtext(67);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(68, AddProductComponent_div_68_Template, 3, 2, \"div\", 25);\n          i0.ɵɵelementEnd()()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngIf\", ctx.errorMsg);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"formGroup\", ctx.productForm);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"ngIf\", ctx.f[\"name\"].touched && ctx.f[\"name\"].invalid);\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"ngForOf\", ctx.categories);\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"ngForOf\", ctx.subcategories);\n          i0.ɵɵadvance(6);\n          i0.ɵɵproperty(\"value\", true);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"value\", false);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"value\", null);\n          i0.ɵɵadvance(25);\n          i0.ɵɵtextInterpolate1(\"Upload Images (max \", ctx.maxImages, \")\");\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngForOf\", ctx.previewUrls);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"disabled\", ctx.uploading);\n          i0.ɵɵadvance();\n          i0.ɵɵtextInterpolate1(\" \", ctx.uploading ? \"Uploading...\" : \"Add Product\", \" \");\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.uploading);\n        }\n      },\n      dependencies: [FormsModule, i1.ɵNgNoValidate, i1.NgSelectOption, i1.ɵNgSelectMultipleOption, i1.DefaultValueAccessor, i1.NumberValueAccessor, i1.SelectControlValueAccessor, i1.RadioControlValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, ReactiveFormsModule, i1.FormGroupDirective, i1.FormControlName],\n      styles: [\".p-8[_ngcontent-%COMP%]{background:#f5f7fa;min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding-top:40px}.max-w-3xl[_ngcontent-%COMP%]{background:#fff;border-radius:20px;padding:40px;box-shadow:0 8px 24px #00000014;transition:all .3s ease-in-out}.max-w-3xl[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 10px 28px #0000001a}.max-w-3xl[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-weight:700;font-size:28px;color:#2563eb;text-align:center;margin-bottom:25px}label[_ngcontent-%COMP%]{font-family:Poppins,sans-serif;font-weight:500;color:#374151;display:block;margin-bottom:6px}input[type=text][_ngcontent-%COMP%], input[type=number][_ngcontent-%COMP%], input[type=file][_ngcontent-%COMP%], select[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%;padding:10px 14px;border:1px solid #d1d5db;border-radius:10px;font-family:Poppins,sans-serif;font-size:15px;color:#111827;background:#fff;transition:all .25s ease}input[type=text][_ngcontent-%COMP%]:focus, input[type=number][_ngcontent-%COMP%]:focus, input[type=file][_ngcontent-%COMP%]:focus, select[_ngcontent-%COMP%]:focus, textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#2563eb;box-shadow:0 0 0 3px #2563eb40}input[type=text][_ngcontent-%COMP%]::placeholder, input[type=number][_ngcontent-%COMP%]::placeholder, input[type=file][_ngcontent-%COMP%]::placeholder, select[_ngcontent-%COMP%]::placeholder, textarea[_ngcontent-%COMP%]::placeholder{color:#9ca3af}textarea[_ngcontent-%COMP%]{resize:none}.flex.gap-4[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-weight:500;color:#374151;cursor:pointer}.flex.gap-4[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   input[type=radio][_ngcontent-%COMP%]{accent-color:#2563eb}.flex.flex-wrap[_ngcontent-%COMP%]{gap:12px}.flex.flex-wrap[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:96px;height:96px;border-radius:10px;object-fit:cover;border:2px solid #e5e7eb;transition:transform .2s ease}.flex.flex-wrap[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]:hover{transform:scale(1.05)}.flex.flex-wrap[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:#ef4444;color:#fff;font-size:12px;border:none;width:22px;height:22px;border-radius:50%;cursor:pointer;position:absolute;top:-6px;right:-6px;display:flex;align-items:center;justify-content:center;transition:background .2s ease}.flex.flex-wrap[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#dc2626}button[type=submit][_ngcontent-%COMP%]{background:#2563eb;color:#fff;font-family:Poppins,sans-serif;font-weight:600;border:none;border-radius:10px;padding:10px 24px;transition:all .25s ease;box-shadow:0 4px 8px #2563eb4d}button[type=submit][_ngcontent-%COMP%]:hover:not(:disabled){background:#1d4ed8;box-shadow:0 6px 12px #1d4ed859;transform:translateY(-1px)}button[type=submit][_ngcontent-%COMP%]:disabled{background:#93c5fd;cursor:not-allowed}.bg-gray-200[_ngcontent-%COMP%]{background:#e5e7eb;border-radius:9999px}.bg-gray-200[_ngcontent-%COMP%]   .bg-blue-600[_ngcontent-%COMP%]{background:linear-gradient(90deg,#2563eb,#3b82f6);height:8px;border-radius:9999px;transition:width .4s ease}.text-red-600[_ngcontent-%COMP%], .text-red-500[_ngcontent-%COMP%]{color:#ef4444;font-weight:500;font-size:14px;margin-top:4px;text-align:left}\"]\n    }));\n  }\n  _staticBlock();\n  return AddProductComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}
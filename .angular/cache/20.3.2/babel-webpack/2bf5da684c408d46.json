{"ast":null,"code":"import { HttpEventType } from '@angular/common/http';\nimport { FormsModule, ReactiveFormsModule, Validators } from '@angular/forms';\nimport { finalize } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../../../core/services/product.service\";\nfunction AddProductComponent_div_9_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Name is required.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddProductComponent_div_9_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Max length exceeded.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddProductComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 28);\n    i0.ɵɵtemplate(1, AddProductComponent_div_9_div_1_Template, 2, 0, \"div\", 29)(2, AddProductComponent_div_9_div_2_Template, 2, 0, \"div\", 29);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.f.name.errors == null ? null : ctx_r0.f.name.errors.required);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.f.name.errors == null ? null : ctx_r0.f.name.errors.maxlength);\n  }\n}\nfunction AddProductComponent_option_43_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const c_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", c_r2.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(c_r2.name);\n  }\n}\nfunction AddProductComponent_div_44_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 28);\n    i0.ɵɵtext(1, \"Category is required.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddProductComponent_option_51_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const s_r3 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", s_r3.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(s_r3.name);\n  }\n}\nfunction AddProductComponent_div_52_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 28);\n    i0.ɵɵtext(1, \"Subcategory is required.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddProductComponent_div_61_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 30);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r0.errorMsg);\n  }\n}\nfunction AddProductComponent_div_63_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 31);\n    i0.ɵɵelement(1, \"img\", 32);\n    i0.ɵɵelementStart(2, \"button\", 33);\n    i0.ɵɵlistener(\"click\", function AddProductComponent_div_63_Template_button_click_2_listener() {\n      const i_r5 = i0.ɵɵrestoreView(_r4).index;\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.removeImage(i_r5));\n    });\n    i0.ɵɵtext(3, \"\\u00D7\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const src_r6 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"src\", src_r6, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction AddProductComponent_div_67_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 34)(1, \"div\", 35);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵstyleProp(\"width\", ctx_r0.uploadProgress, \"%\");\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.uploadProgress, \"% \");\n  }\n}\nexport let AddProductComponent = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class AddProductComponent {\n    constructor(fb, productService) {\n      this.fb = fb;\n      this.productService = productService;\n      this.categories = [];\n      this.subcategories = [];\n      this.images = [];\n      this.previewUrls = [];\n      this.maxImages = 4;\n      this.uploading = false;\n      this.uploadProgress = 0;\n      this.errorMsg = '';\n      this.productForm = this.fb.group({\n        name: ['', [Validators.required, Validators.maxLength(120)]],\n        description: ['', [Validators.maxLength(2000)]],\n        size: [''],\n        color: [''],\n        pricePerDay: [null, [Validators.min(0)]],\n        priceForSale: [null, [Validators.min(0)]],\n        available: [true, Validators.required],\n        categoryId: [null, Validators.required],\n        subcategoryId: [null, Validators.required]\n      });\n    }\n    ngOnInit() {\n      this.loadCategories();\n      // when category changes, fetch subcategories\n      this.productForm.get('categoryId')?.valueChanges.subscribe(catId => {\n        this.subcategories = [];\n        this.productForm.get('subcategoryId')?.setValue(null);\n        if (catId) {\n          this.loadSubcategories(catId);\n        }\n      });\n    }\n    loadCategories() {\n      this.productService.getCategories().subscribe({\n        next: cats => this.categories = cats,\n        error: () => this.categories = []\n      });\n    }\n    loadSubcategories(categoryId) {\n      this.productService.getSubcategories(categoryId).subscribe({\n        next: subs => this.subcategories = subs,\n        error: () => this.subcategories = []\n      });\n    }\n    onImageSelect(event) {\n      this.errorMsg = '';\n      const input = event.target;\n      if (!input.files) return;\n      const selected = Array.from(input.files);\n      if (this.images.length + selected.length > this.maxImages) {\n        this.errorMsg = `Maximum ${this.maxImages} images allowed.`;\n        return;\n      }\n      selected.forEach(file => {\n        // basic image type check\n        if (!file.type.startsWith('image/')) return;\n        this.images.push(file);\n        const reader = new FileReader();\n        reader.onload = e => this.previewUrls.push(e.target.result);\n        reader.readAsDataURL(file);\n      });\n      // reset input to allow same-file reselect if user removed\n      input.value = '';\n    }\n    removeImage(index) {\n      this.images.splice(index, 1);\n      this.previewUrls.splice(index, 1);\n    }\n    // Build the FormData payload: product JSON + images[]\n    buildFormData() {\n      const formData = new FormData();\n      // product json as 'product' part (server expects this name — adjust if needed)\n      const productPayload = {\n        name: this.productForm.value.name,\n        description: this.productForm.value.description,\n        size: this.productForm.value.size,\n        color: this.productForm.value.color,\n        pricePerDay: this.productForm.value.pricePerDay,\n        priceForSale: this.productForm.value.priceForSale,\n        available: this.productForm.value.available,\n        categoryId: this.productForm.value.categoryId,\n        subcategoryId: this.productForm.value.subcategoryId\n        // add userId server side or include if required\n      };\n      formData.append('product', new Blob([JSON.stringify(productPayload)], {\n        type: 'application/json'\n      }));\n      this.images.forEach((file, idx) => {\n        // server should accept images as 'images' or 'images[]' — adjust name if needed\n        formData.append('images', file, file.name);\n      });\n      return formData;\n    }\n    submit() {\n      this.errorMsg = '';\n      if (this.productForm.invalid) {\n        this.productForm.markAllAsTouched();\n        return;\n      }\n      if (this.images.length === 0) {\n        this.errorMsg = 'Please upload at least one image.';\n        return;\n      }\n      const formData = this.buildFormData();\n      this.uploading = true;\n      this.uploadProgress = 0;\n      this.productService.createProduct(formData).pipe(finalize(() => this.uploading = false)).subscribe({\n        next: event => {\n          if (event.type === HttpEventType.UploadProgress && event.total) {\n            this.uploadProgress = Math.round(100 * (event.loaded / event.total));\n          } else if (event.type === HttpEventType.Response) {\n            // Success\n            console.log('Upload response', event.body);\n            // reset form & previews\n            this.productForm.reset({\n              available: true\n            });\n            this.images = [];\n            this.previewUrls = [];\n            this.uploadProgress = 0;\n            // show success UI (toast / redirect)\n            alert('Product created successfully');\n          }\n        },\n        error: err => {\n          console.error(err);\n          this.errorMsg = 'Upload failed. Try again.';\n        }\n      });\n    }\n    // convenience getters for template\n    get f() {\n      return this.productForm.controls;\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function AddProductComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || AddProductComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.ProductService));\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AddProductComponent,\n      selectors: [[\"app-add-product\"]],\n      decls: 68,\n      vars: 16,\n      consts: [[1, \"add-product-container\"], [1, \"text-center\", \"mb-4\"], [\"novalidate\", \"\", 3, \"ngSubmit\", \"formGroup\"], [1, \"row\", \"g-3\"], [1, \"col-md-6\"], [1, \"form-label\"], [\"formControlName\", \"name\", \"placeholder\", \"Enter product name\", 1, \"form-control\"], [\"class\", \"text-danger small\", 4, \"ngIf\"], [\"formControlName\", \"color\", \"placeholder\", \"e.g., Brown\", 1, \"form-control\"], [1, \"row\", \"g-3\", \"mt-2\"], [\"formControlName\", \"size\", \"placeholder\", \"e.g., 120x60x75 cm\", 1, \"form-control\"], [\"formControlName\", \"available\", 1, \"form-select\"], [3, \"ngValue\"], [\"formControlName\", \"pricePerDay\", \"type\", \"number\", \"placeholder\", \"e.g., 150\", 1, \"form-control\"], [\"formControlName\", \"priceForSale\", \"type\", \"number\", \"placeholder\", \"e.g., 4500\", 1, \"form-control\"], [\"formControlName\", \"categoryId\", 1, \"form-select\"], [3, \"value\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"formControlName\", \"subcategoryId\", 1, \"form-select\"], [1, \"mt-3\"], [\"formControlName\", \"description\", \"rows\", \"3\", \"placeholder\", \"Write product description...\", 1, \"form-control\"], [\"type\", \"file\", \"accept\", \"image/*\", \"multiple\", \"\", 1, \"form-control\", 3, \"change\"], [\"class\", \"text-danger small mt-1\", 4, \"ngIf\"], [1, \"image-preview\", \"mt-3\"], [\"class\", \"img-box\", 4, \"ngFor\", \"ngForOf\"], [1, \"mt-4\"], [\"type\", \"submit\", 1, \"btn\", \"btn-submit\", \"w-100\", \"btn-lg\", 3, \"disabled\"], [\"class\", \"progress mt-3\", 4, \"ngIf\"], [1, \"text-danger\", \"small\"], [4, \"ngIf\"], [1, \"text-danger\", \"small\", \"mt-1\"], [1, \"img-box\"], [\"alt\", \"Preview\", 3, \"src\"], [\"type\", \"button\", 1, \"remove-btn\", 3, \"click\"], [1, \"progress\", \"mt-3\"], [\"role\", \"progressbar\", \"aria-valuemin\", \"0\", \"aria-valuemax\", \"100\", 1, \"progress-bar\"]],\n      template: function AddProductComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"h2\", 1);\n          i0.ɵɵtext(2, \"Add New Product\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(3, \"form\", 2);\n          i0.ɵɵlistener(\"ngSubmit\", function AddProductComponent_Template_form_ngSubmit_3_listener() {\n            return ctx.submit();\n          });\n          i0.ɵɵelementStart(4, \"div\", 3)(5, \"div\", 4)(6, \"label\", 5);\n          i0.ɵɵtext(7, \"Product Name *\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(8, \"input\", 6);\n          i0.ɵɵtemplate(9, AddProductComponent_div_9_Template, 3, 2, \"div\", 7);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(10, \"div\", 4)(11, \"label\", 5);\n          i0.ɵɵtext(12, \"Color\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(13, \"input\", 8);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(14, \"div\", 9)(15, \"div\", 4)(16, \"label\", 5);\n          i0.ɵɵtext(17, \"Size\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(18, \"input\", 10);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(19, \"div\", 4)(20, \"label\", 5);\n          i0.ɵɵtext(21, \"Available\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(22, \"select\", 11)(23, \"option\", 12);\n          i0.ɵɵtext(24, \"Yes\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(25, \"option\", 12);\n          i0.ɵɵtext(26, \"No\");\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(27, \"div\", 9)(28, \"div\", 4)(29, \"label\", 5);\n          i0.ɵɵtext(30, \"Price Per Day\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(31, \"input\", 13);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(32, \"div\", 4)(33, \"label\", 5);\n          i0.ɵɵtext(34, \"Price For Sale\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(35, \"input\", 14);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(36, \"div\", 9)(37, \"div\", 4)(38, \"label\", 5);\n          i0.ɵɵtext(39, \"Category *\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(40, \"select\", 15)(41, \"option\", 16);\n          i0.ɵɵtext(42, \"Select Category\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(43, AddProductComponent_option_43_Template, 2, 2, \"option\", 17);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(44, AddProductComponent_div_44_Template, 2, 0, \"div\", 7);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(45, \"div\", 4)(46, \"label\", 5);\n          i0.ɵɵtext(47, \"Subcategory *\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(48, \"select\", 18)(49, \"option\", 16);\n          i0.ɵɵtext(50, \"Select Subcategory\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(51, AddProductComponent_option_51_Template, 2, 2, \"option\", 17);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(52, AddProductComponent_div_52_Template, 2, 0, \"div\", 7);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(53, \"div\", 19)(54, \"label\", 5);\n          i0.ɵɵtext(55, \"Description\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(56, \"textarea\", 20);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(57, \"div\", 19)(58, \"label\", 5);\n          i0.ɵɵtext(59);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(60, \"input\", 21);\n          i0.ɵɵlistener(\"change\", function AddProductComponent_Template_input_change_60_listener($event) {\n            return ctx.onImageSelect($event);\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(61, AddProductComponent_div_61_Template, 2, 1, \"div\", 22);\n          i0.ɵɵelementStart(62, \"div\", 23);\n          i0.ɵɵtemplate(63, AddProductComponent_div_63_Template, 4, 1, \"div\", 24);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(64, \"div\", 25)(65, \"button\", 26);\n          i0.ɵɵtext(66);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(67, AddProductComponent_div_67_Template, 3, 3, \"div\", 27);\n          i0.ɵɵelementEnd()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"formGroup\", ctx.productForm);\n          i0.ɵɵadvance(6);\n          i0.ɵɵproperty(\"ngIf\", ctx.f.name.touched && ctx.f.name.invalid);\n          i0.ɵɵadvance(14);\n          i0.ɵɵproperty(\"ngValue\", true);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngValue\", false);\n          i0.ɵɵadvance(16);\n          i0.ɵɵproperty(\"value\", null);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.categories);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.f.categoryId.touched && ctx.f.categoryId.invalid);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"value\", null);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.subcategories);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.f.subcategoryId.touched && ctx.f.subcategoryId.invalid);\n          i0.ɵɵadvance(7);\n          i0.ɵɵtextInterpolate1(\"Upload Images (Max \", ctx.maxImages, \") *\");\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngIf\", ctx.errorMsg);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.previewUrls);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"disabled\", ctx.productForm.invalid || ctx.images.length === 0 || ctx.uploading);\n          i0.ɵɵadvance();\n          i0.ɵɵtextInterpolate1(\" \", ctx.uploading ? \"Uploading... \" + ctx.uploadProgress + \"%\" : \"Add Product\", \" \");\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.uploading);\n        }\n      },\n      dependencies: [FormsModule, i1.ɵNgNoValidate, i1.NgSelectOption, i1.ɵNgSelectMultipleOption, i1.DefaultValueAccessor, i1.NumberValueAccessor, i1.SelectControlValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, ReactiveFormsModule, i1.FormGroupDirective, i1.FormControlName],\n      styles: [\".add-product-container[_ngcontent-%COMP%]{background-color:#f0f2f5;border-radius:1.25rem;padding:2rem;max-width:800px;margin:2rem auto;box-shadow:0 15px 35px #00000026}.btn-submit[_ngcontent-%COMP%]{background-color:#2563eb;color:#fff;font-weight:600}.btn-submit[_ngcontent-%COMP%]:hover{background-color:#1d4ed8}.image-preview[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap}.image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:120px;height:120px;object-fit:cover;border-radius:.5rem;box-shadow:0 5px 12px #0000001f}.img-box[_ngcontent-%COMP%]{position:relative}.remove-btn[_ngcontent-%COMP%]{position:absolute;top:-8px;right:-8px;border-radius:50%;width:26px;height:26px;background:#dc3545;color:#fff;border:none;cursor:pointer;font-size:14px}\"]\n    }));\n  }\n  _staticBlock();\n  return AddProductComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}
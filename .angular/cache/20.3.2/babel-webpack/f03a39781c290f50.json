{"ast":null,"code":"import { HttpEventType } from '@angular/common/http';\nimport { FormsModule, ReactiveFormsModule, Validators } from '@angular/forms';\nimport { finalize } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../../../core/services/product.service\";\nfunction AddProductComponent_div_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 27);\n    i0.ɵɵtext(1, \" Name is required. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddProductComponent_option_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 28);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const c_r1 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", c_r1.id);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(c_r1.name);\n  }\n}\nfunction AddProductComponent_div_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 27);\n    i0.ɵɵtext(1, \" Category is required. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AddProductComponent_div_45_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 29)(1, \"div\", 30);\n    i0.ɵɵelement(2, \"img\", 31);\n    i0.ɵɵelementStart(3, \"button\", 32);\n    i0.ɵɵlistener(\"click\", function AddProductComponent_div_45_Template_button_click_3_listener() {\n      const i_r3 = i0.ɵɵrestoreView(_r2).index;\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.removeImage(i_r3));\n    });\n    i0.ɵɵelement(4, \"i\", 33);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const img_r5 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"src\", img_r5, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction AddProductComponent_div_46_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 34)(1, \"label\", 35);\n    i0.ɵɵelement(2, \"i\", 36);\n    i0.ɵɵelementStart(3, \"div\", 4);\n    i0.ɵɵtext(4, \"Click to upload\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"input\", 37);\n    i0.ɵɵlistener(\"change\", function AddProductComponent_div_46_Template_input_change_5_listener($event) {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.onImageSelect($event));\n    });\n    i0.ɵɵelementEnd()()();\n  }\n}\nfunction AddProductComponent_div_47_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 38);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r3.errorMsg);\n  }\n}\nfunction AddProductComponent_div_50_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 39)(1, \"div\", 40);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵstyleProp(\"width\", ctx_r3.uploadProgress, \"%\");\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r3.uploadProgress, \"% \");\n  }\n}\nexport let AddProductComponent = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class AddProductComponent {\n    constructor(fb, productService) {\n      this.fb = fb;\n      this.productService = productService;\n      this.categories = [];\n      this.subcategories = [];\n      this.images = [];\n      this.previewUrls = [];\n      this.maxImages = 4;\n      this.uploading = false;\n      this.uploadProgress = 0;\n      this.errorMsg = '';\n      this.productForm = this.fb.group({\n        name: ['', [Validators.required, Validators.maxLength(120)]],\n        description: ['', [Validators.maxLength(2000)]],\n        size: [''],\n        color: [''],\n        pricePerDay: [null, [Validators.min(0)]],\n        priceForSale: [null, [Validators.min(0)]],\n        available: [true, Validators.required],\n        categoryId: [null, Validators.required],\n        subcategoryId: [null, Validators.required]\n      });\n    }\n    ngOnInit() {\n      this.loadCategories();\n      // when category changes, fetch subcategories\n      this.productForm.get('categoryId')?.valueChanges.subscribe(catId => {\n        this.subcategories = [];\n        this.productForm.get('subcategoryId')?.setValue(null);\n        if (catId) {\n          this.loadSubcategories(catId);\n        }\n      });\n    }\n    loadCategories() {\n      this.productService.getCategories().subscribe({\n        next: cats => this.categories = cats,\n        error: () => this.categories = []\n      });\n    }\n    loadSubcategories(categoryId) {\n      this.productService.getSubcategories(categoryId).subscribe({\n        next: subs => this.subcategories = subs,\n        error: () => this.subcategories = []\n      });\n    }\n    onImageSelect(event) {\n      this.errorMsg = '';\n      const input = event.target;\n      if (!input.files) return;\n      const selected = Array.from(input.files);\n      if (this.images.length + selected.length > this.maxImages) {\n        this.errorMsg = `Maximum ${this.maxImages} images allowed.`;\n        return;\n      }\n      selected.forEach(file => {\n        // basic image type check\n        if (!file.type.startsWith('image/')) return;\n        this.images.push(file);\n        const reader = new FileReader();\n        reader.onload = e => this.previewUrls.push(e.target.result);\n        reader.readAsDataURL(file);\n      });\n      // reset input to allow same-file reselect if user removed\n      input.value = '';\n    }\n    removeImage(index) {\n      this.images.splice(index, 1);\n      this.previewUrls.splice(index, 1);\n    }\n    // Build the FormData payload: product JSON + images[]\n    buildFormData() {\n      const formData = new FormData();\n      // product json as 'product' part (server expects this name — adjust if needed)\n      const productPayload = {\n        name: this.productForm.value.name,\n        description: this.productForm.value.description,\n        size: this.productForm.value.size,\n        color: this.productForm.value.color,\n        pricePerDay: this.productForm.value.pricePerDay,\n        priceForSale: this.productForm.value.priceForSale,\n        available: this.productForm.value.available,\n        categoryId: this.productForm.value.categoryId,\n        subcategoryId: this.productForm.value.subcategoryId\n        // add userId server side or include if required\n      };\n      formData.append('product', new Blob([JSON.stringify(productPayload)], {\n        type: 'application/json'\n      }));\n      this.images.forEach((file, idx) => {\n        // server should accept images as 'images' or 'images[]' — adjust name if needed\n        formData.append('images', file, file.name);\n      });\n      return formData;\n    }\n    submit() {\n      this.errorMsg = '';\n      if (this.productForm.invalid) {\n        this.productForm.markAllAsTouched();\n        return;\n      }\n      if (this.images.length === 0) {\n        this.errorMsg = 'Please upload at least one image.';\n        return;\n      }\n      const formData = this.buildFormData();\n      this.uploading = true;\n      this.uploadProgress = 0;\n      this.productService.createProduct(formData).pipe(finalize(() => this.uploading = false)).subscribe({\n        next: event => {\n          if (event.type === HttpEventType.UploadProgress && event.total) {\n            this.uploadProgress = Math.round(100 * (event.loaded / event.total));\n          } else if (event.type === HttpEventType.Response) {\n            // Success\n            console.log('Upload response', event.body);\n            // reset form & previews\n            this.productForm.reset({\n              available: true\n            });\n            this.images = [];\n            this.previewUrls = [];\n            this.uploadProgress = 0;\n            // show success UI (toast / redirect)\n            alert('Product created successfully');\n          }\n        },\n        error: err => {\n          console.error(err);\n          this.errorMsg = 'Upload failed. Try again.';\n        }\n      });\n    }\n    // convenience getters for template\n    get f() {\n      return this.productForm.controls;\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function AddProductComponent_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || AddProductComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.ProductService));\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: AddProductComponent,\n      selectors: [[\"app-add-product\"]],\n      decls: 51,\n      vars: 9,\n      consts: [[1, \"d-flex\", \"justify-content-center\", \"align-items-start\", \"bg-lightest\", \"min-vh-100\", \"py-5\"], [1, \"product-card\", \"shadow-lg\", \"rounded-4\", \"bg-white\", \"p-5\", 2, \"max-width\", \"800px\", \"width\", \"100%\"], [1, \"card-header\", \"text-center\", \"mb-4\"], [1, \"fw-bold\"], [1, \"text-muted\"], [\"novalidate\", \"\", 3, \"ngSubmit\", \"formGroup\"], [1, \"mb-4\"], [1, \"fw-semibold\", \"mb-3\"], [1, \"row\", \"g-3\"], [1, \"col-md-6\"], [1, \"form-label\"], [\"formControlName\", \"name\", \"placeholder\", \"Enter product name\", 1, \"form-control\", \"form-control-lg\"], [\"class\", \"form-text text-danger\", 4, \"ngIf\"], [\"formControlName\", \"categoryId\", 1, \"form-select\", \"form-select-lg\"], [\"value\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"number\", \"formControlName\", \"pricePerDay\", \"placeholder\", \"e.g. 150\", 1, \"form-control\", \"form-control-lg\"], [\"type\", \"number\", \"formControlName\", \"priceForSale\", \"placeholder\", \"e.g. 4500\", 1, \"form-control\", \"form-control-lg\"], [1, \"form-check\", \"form-switch\", \"mt-3\"], [\"type\", \"checkbox\", \"formControlName\", \"available\", \"id\", \"availableSwitch\", 1, \"form-check-input\"], [\"for\", \"availableSwitch\", 1, \"form-check-label\"], [1, \"mb-5\"], [\"class\", \"col-3\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"col-md-3\", 4, \"ngIf\"], [\"class\", \"text-danger mt-2\", 4, \"ngIf\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", \"btn-lg\", \"w-100\"], [\"class\", \"progress mt-3\", 4, \"ngIf\"], [1, \"form-text\", \"text-danger\"], [3, \"value\"], [1, \"col-3\"], [1, \"image-box\", \"position-relative\", \"rounded-3\", \"overflow-hidden\"], [\"alt\", \"Preview\", 1, \"img-fluid\", 3, \"src\"], [\"type\", \"button\", 1, \"btn\", \"btn-sm\", \"btn-danger\", \"position-absolute\", \"top-0\", \"end-0\", \"m-2\", 3, \"click\"], [1, \"fas\", \"fa-times\"], [1, \"col-md-3\"], [1, \"d-block\", \"border\", \"dashed\", \"rounded-3\", \"text-center\", \"p-4\", \"upload-placeholder\"], [1, \"fas\", \"fa-cloud-upload-alt\", \"fa-2x\", \"mb-2\", \"text-secondary\"], [\"type\", \"file\", \"accept\", \"image/*\", \"multiple\", \"\", 1, \"upload-input\", 3, \"change\"], [1, \"text-danger\", \"mt-2\"], [1, \"progress\", \"mt-3\"], [\"role\", \"progressbar\", \"aria-valuemin\", \"0\", \"aria-valuemax\", \"100\", 1, \"progress-bar\"]],\n      template: function AddProductComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"h1\", 3);\n          i0.ɵɵtext(4, \"Add New Product\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(5, \"p\", 4);\n          i0.ɵɵtext(6, \"Let\\u2019s get your product listed \\u2014 fill in the details below\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(7, \"form\", 5);\n          i0.ɵɵlistener(\"ngSubmit\", function AddProductComponent_Template_form_ngSubmit_7_listener() {\n            return ctx.submit();\n          });\n          i0.ɵɵelementStart(8, \"div\", 6)(9, \"h5\", 7);\n          i0.ɵɵtext(10, \"Basic Info\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(11, \"div\", 8)(12, \"div\", 9)(13, \"label\", 10);\n          i0.ɵɵtext(14, \"Product Name *\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(15, \"input\", 11);\n          i0.ɵɵtemplate(16, AddProductComponent_div_16_Template, 2, 0, \"div\", 12);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(17, \"div\", 9)(18, \"label\", 10);\n          i0.ɵɵtext(19, \"Category *\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(20, \"select\", 13)(21, \"option\", 14);\n          i0.ɵɵtext(22, \"Select category\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(23, AddProductComponent_option_23_Template, 2, 2, \"option\", 15);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(24, AddProductComponent_div_24_Template, 2, 0, \"div\", 12);\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(25, \"div\", 6)(26, \"h5\", 7);\n          i0.ɵɵtext(27, \"Pricing & Availability\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(28, \"div\", 8)(29, \"div\", 9)(30, \"label\", 10);\n          i0.ɵɵtext(31, \"Price Per Day\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(32, \"input\", 16);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(33, \"div\", 9)(34, \"label\", 10);\n          i0.ɵɵtext(35, \"Price For Sale\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelement(36, \"input\", 17);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(37, \"div\", 18);\n          i0.ɵɵelement(38, \"input\", 19);\n          i0.ɵɵelementStart(39, \"label\", 20);\n          i0.ɵɵtext(40, \"Available for rent\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(41, \"div\", 21)(42, \"h5\", 7);\n          i0.ɵɵtext(43);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(44, \"div\", 8);\n          i0.ɵɵtemplate(45, AddProductComponent_div_45_Template, 5, 1, \"div\", 22)(46, AddProductComponent_div_46_Template, 6, 0, \"div\", 23);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(47, AddProductComponent_div_47_Template, 2, 1, \"div\", 24);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(48, \"button\", 25);\n          i0.ɵɵtext(49, \"Save Product\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(50, AddProductComponent_div_50_Template, 3, 3, \"div\", 26);\n          i0.ɵɵelementEnd()()();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"formGroup\", ctx.productForm);\n          i0.ɵɵadvance(9);\n          i0.ɵɵproperty(\"ngIf\", ctx.f.name.touched && ctx.f.name.invalid);\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"ngForOf\", ctx.categories);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.f.categoryId.touched && ctx.f.categoryId.invalid);\n          i0.ɵɵadvance(19);\n          i0.ɵɵtextInterpolate1(\"Product Images (Max \", ctx.maxImages, \")\");\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngForOf\", ctx.previewUrls);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.previewUrls.length < ctx.maxImages);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.errorMsg);\n          i0.ɵɵadvance(3);\n          i0.ɵɵproperty(\"ngIf\", ctx.uploading);\n        }\n      },\n      dependencies: [FormsModule, i1.ɵNgNoValidate, i1.NgSelectOption, i1.ɵNgSelectMultipleOption, i1.DefaultValueAccessor, i1.NumberValueAccessor, i1.CheckboxControlValueAccessor, i1.SelectControlValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, ReactiveFormsModule, i1.FormGroupDirective, i1.FormControlName],\n      styles: [\".bg-lightest[_ngcontent-%COMP%]{background-color:#f8f9fa}.upload-placeholder[_ngcontent-%COMP%]{cursor:pointer;height:180px;border:2px dashed #ccc;display:flex;align-items:center;justify-content:center;transition:border-color .3s ease,background-color .2s ease}.upload-placeholder[_ngcontent-%COMP%]:hover{border-color:#2563eb;background-color:#2563eb0d}.upload-input[_ngcontent-%COMP%]{position:absolute;opacity:0;width:100%;height:100%;top:0;left:0;cursor:pointer}.image-box[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:180px;object-fit:cover}\"]\n    }));\n  }\n  _staticBlock();\n  return AddProductComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}